{"version":3,"sources":["webpack://test.Recorder/webpack/universalModuleDefinition","webpack://test.Recorder/./src/recorder.js","webpack://test.Recorder/webpack/bootstrap","webpack://test.Recorder/webpack/runtime/global","webpack://test.Recorder/webpack/startup"],"names":["AudioContext","global","webkitAudioContext","Recorder","config","isRecordingSupported","Error","state","Object","assign","bufferLength","encoderApplication","encoderFrameSize","encoderPath","encoderSampleRate","maxFramesPerPage","mediaTrackConstraints","monitorGain","numberOfChannels","recordingGain","resampleQuality","streamPages","wavBitDepth","sourceNode","context","encodedSamplePosition","initAudioContext","initialize","initWorklet","then","initEncoder","getUserMediaSupported","navigator","mediaDevices","getUserMedia","WebAssembly","version","prototype","clearStream","stream","getTracks","forEach","track","stop","close","monitorGainNode","disconnect","recordingGainNode","encoder","encoderNode","postMessage","command","audioContext","Promise","resolve","encodeBuffers","inputBuffer","buffers","i","getChannelData","createGain","setMonitorGain","setRecordingGain","audioWorklet","AudioWorkletNode","numberOfOutputs","port","console","log","createScriptProcessor","onaudioprocess","connect","destination","Worker","initSourceNode","audio","createMediaStreamSource","initWorker","onPage","streamPage","storePage","bind","recordedPages","totalLength","callback","data","removeEventListener","finish","addEventListener","start","originalSampleRate","sampleRate","wavSampleRate","addModule","pause","flush","onpause","resume","onresume","gain","setTargetAtTime","currentTime","all","onstart","error","page","push","length","ondataavailable","outputData","Uint8Array","reduce","offset","set","onstop","module","exports"],"mappings":"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","file":"recorder.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"test\"] = factory();\n\telse\n\t\troot[\"test\"] = root[\"test\"] || {}, root[\"test\"][\"Recorder\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn ","\"use strict\";\n\nvar AudioContext = global.AudioContext || global.webkitAudioContext;\n\n\n// Constructor\nvar Recorder = function( config = {} ){\n\n  if ( !Recorder.isRecordingSupported() ) {\n    throw new Error(\"Recording is not supported in this browser\");\n  }\n\n  this.state = \"inactive\";\n  this.config = Object.assign({\n    bufferLength: 4096,\n    encoderApplication: 2049,\n    encoderFrameSize: 10,\n    encoderPath: 'encoderWorker.min.js',\n    encoderSampleRate: 48000,\n    maxFramesPerPage: 40,\n    mediaTrackConstraints: true,\n    monitorGain: 0,\n    numberOfChannels: 1,\n    recordingGain: 1,\n    resampleQuality: 3,\n    streamPages: false,\n    wavBitDepth: 16,\n    sourceNode: { context: null },\n  }, config );\n\n  this.encodedSamplePosition = 0;\n  this.initAudioContext();\n  this.initialize = this.initWorklet().then(() => this.initEncoder());\n};\n\n\n// Static Methods\nRecorder.isRecordingSupported = function(){\n  const getUserMediaSupported = global.navigator && global.navigator.mediaDevices && global.navigator.mediaDevices.getUserMedia;\n  return AudioContext && getUserMediaSupported && global.WebAssembly;\n};\n\nRecorder.version = '8.1.0';\n\n\n// Instance Methods\nRecorder.prototype.clearStream = function(){\n  if ( this.stream ){\n\n    if ( this.stream.getTracks ) {\n      this.stream.getTracks().forEach(track => track.stop());\n    }\n\n    else {\n      this.stream.stop();\n    }\n  }\n};\n\nRecorder.prototype.close = function() {\n  this.monitorGainNode.disconnect();\n  this.recordingGainNode.disconnect();\n\n  if (this.sourceNode) {\n    this.sourceNode.disconnect();\n  }\n\n  this.clearStream();\n\n  if (this.encoder) {\n    this.encoderNode.disconnect();\n    this.encoder.postMessage({ command: \"close\" });\n  }\n\n  if ( !this.config.sourceNode.context ){\n    return this.audioContext.close();\n  }\n\n  return Promise.resolve();\n}\n\nRecorder.prototype.encodeBuffers = function( inputBuffer ){\n  if ( this.state === \"recording\" ) {\n    var buffers = [];\n    for ( var i = 0; i < inputBuffer.numberOfChannels; i++ ) {\n      buffers[i] = inputBuffer.getChannelData(i);\n    }\n\n    this.encoder.postMessage({\n      command: \"encode\",\n      buffers: buffers\n    });\n  }\n};\n\nRecorder.prototype.initAudioContext = function(){\n  this.audioContext = this.config.sourceNode.context ? this.config.sourceNode.context : new AudioContext();\n\n  this.monitorGainNode = this.audioContext.createGain();\n  this.setMonitorGain( this.config.monitorGain );\n\n  this.recordingGainNode = this.audioContext.createGain();\n  this.setRecordingGain( this.config.recordingGain );\n};\n\nRecorder.prototype.initEncoder = function() {\n\n  if (this.audioContext.audioWorklet) {\n    this.encoderNode = new AudioWorkletNode(this.audioContext, 'encoder-worklet', { numberOfOutputs: 0 });\n    this.encoder = this.encoderNode.port;\n  }\n\n  else {\n    console.log('audioWorklet support not detected. Falling back to scriptProcessor');\n\n    // Skip the first buffer\n    this.encodeBuffers = () => delete this.encodeBuffers;\n\n    this.encoderNode = this.audioContext.createScriptProcessor( this.config.bufferLength, this.config.numberOfChannels, this.config.numberOfChannels );\n    this.encoderNode.onaudioprocess = ({ inputBuffer }) => this.encodeBuffers( inputBuffer );\n    this.encoderNode.connect( this.audioContext.destination ); // Requires connection to destination to process audio\n    this.encoder = new global.Worker(this.config.encoderPath);\n  }\n};\n\nRecorder.prototype.initSourceNode = function(){\n  if ( this.config.sourceNode.context ) {\n    this.sourceNode = this.config.sourceNode;\n    return Promise.resolve();\n  }\n\n  return global.navigator.mediaDevices.getUserMedia({ audio : this.config.mediaTrackConstraints }).then( stream => {\n    this.stream = stream;\n    this.sourceNode = this.audioContext.createMediaStreamSource( stream );\n  });\n};\n\nRecorder.prototype.initWorker = function(){\n  var onPage = (this.config.streamPages ? this.streamPage : this.storePage).bind(this);\n\n  this.recordedPages = [];\n  this.totalLength = 0;\n\n  return new Promise(resolve => {\n    var callback = ({ data }) => {\n      switch( data['message'] ){\n        case 'ready':\n          resolve();\n          break;\n        case 'page':\n          this.encodedSamplePosition = data['samplePosition'];\n          onPage(data['page']);\n          break;\n        case 'done':\n          this.encoder.removeEventListener( \"message\", callback );\n          this.finish();\n          break;\n      }\n    };\n\n    this.encoder.addEventListener( \"message\", callback );\n\n    // must call start for messagePort messages\n    if( this.encoder.start ) {\n      this.encoder.start()\n    }\n\n    // exclude sourceNode\n    const {sourceNode, ...config} = this.config;\n\n    this.encoder.postMessage( Object.assign({\n      command: 'init',\n      originalSampleRate: this.audioContext.sampleRate,\n      wavSampleRate: this.audioContext.sampleRate\n    }, config));\n  });\n};\n\nRecorder.prototype.initWorklet = function() {\n  if (this.audioContext.audioWorklet) {\n    return this.audioContext.audioWorklet.addModule(this.config.encoderPath);\n  }\n\n  return Promise.resolve();\n}\n\nRecorder.prototype.pause = function( flush ) {\n  if ( this.state === \"recording\" ) {\n\n    this.state = \"paused\";\n    this.recordingGainNode.disconnect();\n\n    if ( flush && this.config.streamPages ) {\n      return new Promise(resolve => {\n\n        var callback = ({ data }) => {\n          if ( data[\"message\"] === 'flushed' ) {\n            this.encoder.removeEventListener( \"message\", callback );\n            this.onpause();\n            resolve();\n          }\n        };\n        this.encoder.addEventListener( \"message\", callback );\n\n        // must call start for messagePort messages\n        if ( this.encoder.start ) {\n          this.encoder.start()\n        }\n\n        this.encoder.postMessage( { command: \"flush\" } );\n      });\n    }\n    this.onpause();\n    return Promise.resolve();\n  }\n};\n\nRecorder.prototype.resume = function() {\n  if ( this.state === \"paused\" ) {\n    this.state = \"recording\";\n    this.recordingGainNode.connect(this.encoderNode);\n    this.onresume();\n  }\n};\n\nRecorder.prototype.setRecordingGain = function( gain ){\n  this.config.recordingGain = gain;\n\n  if ( this.recordingGainNode && this.audioContext ) {\n    this.recordingGainNode.gain.setTargetAtTime(gain, this.audioContext.currentTime, 0.01);\n  }\n};\n\nRecorder.prototype.setMonitorGain = function( gain ){\n  this.config.monitorGain = gain;\n\n  if ( this.monitorGainNode && this.audioContext ) {\n    this.monitorGainNode.gain.setTargetAtTime(gain, this.audioContext.currentTime, 0.01);\n  }\n};\n\nRecorder.prototype.start = function(){\n  if ( this.state === \"inactive\" ) {\n    this.state = 'loading';\n    this.encodedSamplePosition = 0;\n\n    return this.audioContext.resume()\n      .then(() => this.initialize)\n      .then(() => Promise.all([this.initSourceNode(), this.initWorker()]))\n      .then(() => {\n        this.state = \"recording\";\n        this.encoder.postMessage({ command: 'getHeaderPages' });\n        this.sourceNode.connect( this.monitorGainNode );\n        this.sourceNode.connect( this.recordingGainNode );\n        this.monitorGainNode.connect( this.audioContext.destination );\n        this.recordingGainNode.connect( this.encoderNode );\n        this.onstart();\n      })\n      .catch(error => {\n        this.state = 'inactive';\n        throw error;\n      });\n  }\n  return Promise.resolve();\n};\n\nRecorder.prototype.stop = function(){\n  if ( this.state === \"paused\" || this.state === \"recording\" ) {\n    this.state = \"inactive\";\n\n    // macOS and iOS requires the source to remain connected (in case stopped while paused)\n    this.recordingGainNode.connect( this.encoderNode ); \n\n    this.monitorGainNode.disconnect();\n    this.clearStream();\n\n    return new Promise(resolve => {\n      var callback = ({ data }) => {\n        if ( data[\"message\"] === 'done' ) {\n          this.encoder.removeEventListener( \"message\", callback );\n          resolve();\n        }\n      };\n\n      this.encoder.addEventListener( \"message\", callback );\n\n      // must call start for messagePort messages\n      if( this.encoder.start ) {\n        this.encoder.start()\n      }\n\n      this.encoder.postMessage({ command: \"done\" });\n    });\n  }\n  return Promise.resolve();\n};\n\nRecorder.prototype.storePage = function( page ) {\n  this.recordedPages.push( page );\n  this.totalLength += page.length;\n};\n\nRecorder.prototype.streamPage = function( page ) {\n  this.ondataavailable( page );\n};\n\nRecorder.prototype.finish = function() {\n  if( !this.config.streamPages ) {\n    var outputData = new Uint8Array( this.totalLength );\n    this.recordedPages.reduce( function( offset, page ){\n      outputData.set( page, offset );\n      return offset + page.length;\n    }, 0);\n\n    this.ondataavailable( outputData );\n  }\n  this.onstop();\n};\n\n\n// Callback Handlers\nRecorder.prototype.ondataavailable = function(){};\nRecorder.prototype.onpause = function(){};\nRecorder.prototype.onresume = function(){};\nRecorder.prototype.onstart = function(){};\nRecorder.prototype.onstop = function(){};\n\n\nmodule.exports = Recorder;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(\"./src/recorder.js\");\n"],"sourceRoot":""}