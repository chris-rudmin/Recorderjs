{"version":3,"sources":["webpack://test.DecoderWorker/webpack/universalModuleDefinition","webpack://test.DecoderWorker/./src/decoderWorker.js","webpack://test.DecoderWorker/webpack/bootstrap","webpack://test.DecoderWorker/webpack/runtime/global","webpack://test.DecoderWorker/webpack/startup"],"names":["decoder","mainReadyResolve","mainReady","Promise","resolve","global","e","then","decode","sendLastBuffer","OggOpusDecoder","Module","config","Error","Object","assign","bufferLength","decoderSampleRate","outputBufferSampleRate","resampleQuality","_opus_decoder_create","_opus_decoder_destroy","_speex_resampler_process_interleaved_float","_speex_resampler_init","_speex_resampler_destroy","_opus_decode_float","_free","_malloc","HEAPU8","HEAP32","HEAPF32","outputBuffers","prototype","typedArray","dataView","DataView","buffer","getPageBoundaries","forEach","pageStart","headerType","getUint8","pageIndex","getUint32","numberOfChannels","init","segmentTableLength","segmentTableIndex","i","packetLength","decoderBuffer","set","subarray","decoderBufferIndex","outputSampleLength","decoderBufferPointer","decoderOutputPointer","decoderOutputMaxLength","resampledLength","Math","ceil","decoderOutputLengthPointer","resampleOutputLengthPointer","resampler","resampleOutputBufferPointer","sendToOutputBuffers","pageBoundaries","byteLength","push","resetOutputBuffers","initCodec","initResampler","errReference","decoderBufferMaxLength","errLocation","resampleOutputMaxLength","outputBufferArrayBuffers","outputBufferIndex","Float32Array","mergedBuffers","dataIndex","mergedBufferLength","length","amountToCopy","min","channelIndex","module","exports"],"mappings":"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","file":"decoderWorker.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"test\"] = factory();\n\telse\n\t\troot[\"test\"] = root[\"test\"] || {}, root[\"test\"][\"DecoderWorker\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn ","\"use strict\";\n\nvar decoder;\nvar mainReadyResolve;\nvar mainReady = new Promise(function(resolve){ mainReadyResolve = resolve; });\n\nglobal['onmessage'] = function( e ){\n  mainReady.then(function(){\n    switch( e['data']['command'] ){\n\n      case 'decode':\n        if (decoder){\n          decoder.decode( e['data']['pages'] );\n        }\n        break;\n\n      case 'done':\n        if (decoder) {\n          decoder.sendLastBuffer();\n          global['close']();\n        }\n        break;\n\n      case 'init':\n        decoder = new OggOpusDecoder( e['data'], Module );\n        break;\n\n      default:\n        // Ignore any unknown commands and continue recieving commands\n    }\n  });\n};\n\nvar OggOpusDecoder = function( config, Module ){\n\n  if ( !Module ) {\n    throw new Error('Module with exports required to initialize a decoder instance');\n  }\n\n  this.mainReady = mainReady; // Expose for unit testing\n  this.config = Object.assign({ \n    bufferLength: 4096, // Define size of outgoing buffer\n    decoderSampleRate: 48000, // Desired decoder sample rate.\n    outputBufferSampleRate: 48000, // Desired output sample rate. Audio will be resampled\n    resampleQuality: 3, // Value between 0 and 10 inclusive. 10 being highest quality.\n  }, config );\n\n  this._opus_decoder_create = Module._opus_decoder_create;\n  this._opus_decoder_destroy = Module._opus_decoder_destroy;\n  this._speex_resampler_process_interleaved_float = Module._speex_resampler_process_interleaved_float;\n  this._speex_resampler_init = Module._speex_resampler_init;\n  this._speex_resampler_destroy = Module._speex_resampler_destroy;\n  this._opus_decode_float = Module._opus_decode_float;\n  this._free = Module._free;\n  this._malloc = Module._malloc;\n  this.HEAPU8 = Module.HEAPU8;\n  this.HEAP32 = Module.HEAP32;\n  this.HEAPF32 = Module.HEAPF32;\n\n  this.outputBuffers = [];\n};\n\n\nOggOpusDecoder.prototype.decode = function( typedArray ) {\n  var dataView = new DataView( typedArray.buffer );\n  this.getPageBoundaries( dataView ).forEach( function( pageStart ) {\n    var headerType = dataView.getUint8( pageStart + 5, true );\n    var pageIndex = dataView.getUint32( pageStart + 18, true );\n\n    // Beginning of stream\n    if ( headerType & 2 ) {\n      this.numberOfChannels = dataView.getUint8( pageStart + 37, true );\n      this.init();\n    }\n\n    // Decode page\n    if ( pageIndex > 1 ) {\n      var segmentTableLength = dataView.getUint8( pageStart + 26, true );\n      var segmentTableIndex = pageStart + 27 + segmentTableLength;\n\n      for ( var i = 0; i < segmentTableLength; i++ ) {\n        var packetLength = dataView.getUint8( pageStart + 27 + i, true );\n        this.decoderBuffer.set( typedArray.subarray( segmentTableIndex, segmentTableIndex += packetLength ), this.decoderBufferIndex );\n        this.decoderBufferIndex += packetLength;\n\n        if ( packetLength < 255 ) {\n          var outputSampleLength = this._opus_decode_float( this.decoder, this.decoderBufferPointer, this.decoderBufferIndex, this.decoderOutputPointer, this.decoderOutputMaxLength, 0);\n          var resampledLength = Math.ceil( outputSampleLength * this.config.outputBufferSampleRate / this.config.decoderSampleRate );\n          this.HEAP32[ this.decoderOutputLengthPointer >> 2 ] = outputSampleLength;\n          this.HEAP32[ this.resampleOutputLengthPointer >> 2 ] = resampledLength;\n          this._speex_resampler_process_interleaved_float( this.resampler, this.decoderOutputPointer, this.decoderOutputLengthPointer, this.resampleOutputBufferPointer, this.resampleOutputLengthPointer );\n          this.sendToOutputBuffers( this.HEAPF32.subarray( this.resampleOutputBufferPointer >> 2, (this.resampleOutputBufferPointer >> 2) + resampledLength * this.numberOfChannels ) );\n          this.decoderBufferIndex = 0;\n        }\n      }\n\n      // End of stream\n      if ( headerType & 4 ) {\n        this.sendLastBuffer();\n      }\n    }\n  }, this );\n};\n\nOggOpusDecoder.prototype.getPageBoundaries = function( dataView ){\n  var pageBoundaries = [];\n\n  for ( var i = 0; i < dataView.byteLength - 32; i++ ) {\n    if ( dataView.getUint32( i, true ) == 1399285583 ) { // Capture Pattern starts all page headers 'OggS'\n      pageBoundaries.push( i );\n    }\n  }\n\n  return pageBoundaries;\n};\n\nOggOpusDecoder.prototype.init = function(){\n  this.resetOutputBuffers();\n  this.initCodec();\n  this.initResampler();\n};\n\nOggOpusDecoder.prototype.initCodec = function() {\n\n  if ( this.decoder ) {\n    this._opus_decoder_destroy( this.decoder );\n    this._free( this.decoderBufferPointer );\n    this._free( this.decoderOutputLengthPointer );\n    this._free( this.decoderOutputPointer );\n  }\n\n  var errReference = this._malloc( 4 );\n  this.decoder = this._opus_decoder_create( this.config.decoderSampleRate, this.numberOfChannels, errReference );\n  this._free( errReference );\n\n  this.decoderBufferMaxLength = 4000;\n  this.decoderBufferPointer = this._malloc( this.decoderBufferMaxLength );\n  this.decoderBuffer = this.HEAPU8.subarray( this.decoderBufferPointer, this.decoderBufferPointer + this.decoderBufferMaxLength );\n  this.decoderBufferIndex = 0;\n\n  this.decoderOutputLengthPointer = this._malloc( 4 );\n  this.decoderOutputMaxLength = this.config.decoderSampleRate * this.numberOfChannels * 120 / 1000; // Max 120ms frame size\n  this.decoderOutputPointer = this._malloc( this.decoderOutputMaxLength * 4 ); // 4 bytes per sample\n};\n\nOggOpusDecoder.prototype.initResampler = function() {\n\n  if ( this.resampler ) {\n    this._speex_resampler_destroy( this.resampler );\n    this._free( this.resampleOutputLengthPointer );\n    this._free( this.resampleOutputBufferPointer );\n  }\n\n  var errLocation = this._malloc( 4 );\n  this.resampler = this._speex_resampler_init( this.numberOfChannels, this.config.decoderSampleRate, this.config.outputBufferSampleRate, this.config.resampleQuality, errLocation );\n  this._free( errLocation );\n\n  this.resampleOutputLengthPointer = this._malloc( 4 );\n  this.resampleOutputMaxLength = Math.ceil( this.decoderOutputMaxLength * this.config.outputBufferSampleRate / this.config.decoderSampleRate );\n  this.resampleOutputBufferPointer = this._malloc( this.resampleOutputMaxLength * 4 ); // 4 bytes per sample\n};\n\nOggOpusDecoder.prototype.resetOutputBuffers = function(){\n  this.outputBuffers = [];\n  this.outputBufferArrayBuffers = [];\n  this.outputBufferIndex = 0;\n\n  for ( var i = 0; i < this.numberOfChannels; i++ ) {\n    this.outputBuffers.push( new Float32Array( this.config.bufferLength ) );\n    this.outputBufferArrayBuffers.push( this.outputBuffers[i].buffer );\n  }\n};\n\nOggOpusDecoder.prototype.sendLastBuffer = function(){\n  this.sendToOutputBuffers( new Float32Array( ( this.config.bufferLength - this.outputBufferIndex ) * this.numberOfChannels ) );\n  global['postMessage'](null);\n};\n\nOggOpusDecoder.prototype.sendToOutputBuffers = function( mergedBuffers ){\n  var dataIndex = 0;\n  var mergedBufferLength = mergedBuffers.length / this.numberOfChannels;\n\n  while ( dataIndex < mergedBufferLength ) {\n    var amountToCopy = Math.min( mergedBufferLength - dataIndex, this.config.bufferLength - this.outputBufferIndex );\n\n    if (this.numberOfChannels === 1) {\n      this.outputBuffers[0].set( mergedBuffers.subarray( dataIndex, dataIndex + amountToCopy ), this.outputBufferIndex );\n    }\n\n    // Deinterleave\n    else {\n      for ( var i = 0; i < amountToCopy; i++ ) {\n        this.outputBuffers.forEach( function( buffer, channelIndex ) {\n          buffer[ this.outputBufferIndex + i ] = mergedBuffers[ ( dataIndex + i ) * this.numberOfChannels + channelIndex ];\n        }, this);\n      }\n    }\n\n    dataIndex += amountToCopy;\n    this.outputBufferIndex += amountToCopy;\n\n    if ( this.outputBufferIndex == this.config.bufferLength ) {\n      global['postMessage']( this.outputBuffers, this.outputBufferArrayBuffers );\n      this.resetOutputBuffers();\n    }\n  }\n};\n\n\nif (!Module) {\n  Module = {};\n}\n\nModule['mainReady'] = mainReady;\nModule['OggOpusDecoder'] = OggOpusDecoder;\nModule['onRuntimeInitialized'] = mainReadyResolve;\n\nmodule.exports = Module;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(\"./src/decoderWorker.js\");\n"],"sourceRoot":""}